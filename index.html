<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ranking de Prioridades - Pr√≥ximos Turnos</title>
  <style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background:#f5f5f5; }
    .container { max-width: 900px; margin:0 auto; background:white; padding:30px; border-radius:8px; box-shadow:0 2px 10px rgba(0,0,0,0.1); }
    .header { margin-bottom:30px; border-bottom:3px solid #333; padding-bottom:15px; }
    .header h1 { font-size:28px; color:#333; display:flex; align-items:center; gap:10px; }
    .header h1::before { content:"üèÜ"; font-size:32px; }
    .info-box { background:#fff3cd; border-left:4px solid #ffc107; padding:15px; margin-bottom:25px; border-radius:4px; }
    .info-box p { color:#856404; font-size:14px; line-height:1.6; }
    .legend { display:flex; gap:20px; margin-bottom:25px; flex-wrap:wrap; }
    .legend-item { display:flex; align-items:center; gap:8px; font-size:13px; }
    .legend-circle { width:24px; height:24px; border-radius:50%; display:flex; align-items:center; justify-content:center; color:white; font-weight:bold; font-size:12px; }
    .legend-circle.verde { background:#27ae60; }
    .legend-circle.amarillo { background:#f39c12; }
    .legend-circle.rojo { background:#e74c3c; }
    .ranking-container { display:flex; flex-direction:column; gap:12px; }
    .ranking-item { display:flex; align-items:center; gap:15px; padding:20px; border-radius:8px; border-left:4px solid transparent; }
    .ranking-item.maxima { background:#d5f4e6; border-left-color:#27ae60; }
    .ranking-item.media { background:#fef5e7; border-left-color:#f39c12; }
    .ranking-item.baja { background:#fadbd8; border-left-color:#e74c3c; }
    .rank-number { width:45px; height:45px; border-radius:50%; display:flex; align-items:center; justify-content:center; color:white; font-weight:bold; font-size:18px; flex-shrink:0; }
    .ranking-item.maxima .rank-number { background:#27ae60; }
    .ranking-item.media .rank-number { background:#f39c12; }
    .ranking-item.baja .rank-number { background:#e74c3c; }
    .ranking-info { flex:1; }
    .ranking-name { font-weight:600; font-size:16px; color:#333; margin-bottom:5px; }
    .ranking-days { font-size:13px; color:#666; }
    .ranking-priority { display:inline-block; padding:6px 12px; border-radius:20px; font-size:12px; font-weight:600; }
    .ranking-item.maxima .ranking-priority { background:#c8e6c9; color:#1b5e20; }
    .ranking-item.media .ranking-priority { background:#ffe0b2; color:#e65100; }
    .ranking-item.baja .ranking-priority { background:#ffcccc; color:#b71c1c; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header"><h1>Ranking de Prioridades - Pr√≥ximos Turnos</h1></div>
    <div class="info-box">
      <p><strong>‚ö° C√≥mo funciona:</strong> Quien ha trabajado <strong>MENOS d√≠as</strong> aparece <strong>ARRIBA (m√°xima prioridad)</strong>. Asigna primero a los de arriba para que todos ganen similar.</p>
    </div>
    <div class="legend">
      <div class="legend-item">
        <div class="legend-circle verde">‚óè</div>
        <span><strong>M√°xima Prioridad</strong> - Pocas X (1-2 d√≠as)</span>
      </div>
      <div class="legend-item">
        <div class="legend-circle amarillo">‚óè</div>
        <span><strong>Prioridad Media</strong> - Medio (3-4 d√≠as)</span>
      </div>
      <div class="legend-item">
        <div class="legend-circle rojo">‚óè</div>
        <span><strong>Baja Prioridad</strong> - Muchas X (5+ d√≠as)</span>
      </div>
    </div>
    <div class="ranking-container" id="rankingContainer"></div>
  </div>
  <script>
    function getCSV(url) {
      return fetch(url)
        .then(r => r.text())
        .then(t => t.split('\n').map(row => row.split(',')));
    }
    function getPriority(dias) {
      if (dias <= 2) return ['M√ÅXIMA PRIORIDAD', 'maxima'];
      if (dias <= 4) return ['PRIORIDAD MEDIA', 'media'];
      return ['BAJA PRIORIDAD', 'baja'];
    }
    function showRanking(data) {
      // Busca la fila donde empiece "TOTAL GENERAL"
      let totalRow = data.findIndex(row => row[0].trim().toUpperCase() === 'TOTAL GENERAL');
      // Busca la base de datos justo debajo, columna Nombre y TOTAL DIAS
      let startRow = (totalRow >= 0) ? totalRow + 1 : data.findIndex(row => row[0].trim() === 'Nombre' && row[1].trim().toLowerCase().includes('total'));
      if (startRow < 0) { document.getElementById('rankingContainer').innerHTML = 'No se encontr√≥ la tabla de totales.'; return; }
      let totales = [];
      for (let i = startRow + 1; i < data.length; i++) {
        let fila = data[i];
        if (!fila[0] || isNaN(fila[1])) break;
        totales.push([fila[0], Number(fila[1]||0)]);
      }
      if (!totales.length) {
        document.getElementById('rankingContainer').innerHTML = 'No se encontraron datos en TOTAL GENERAL.';
        return;
      }
      totales.sort((a,b) => a[1] - b[1]);
      let html = '';
      totales.forEach((r, i) => {
        const [prioText, prioClase] = getPriority(r[1]);
        html += `<div class="ranking-item ${prioClase}"><div class="rank-number">${i+1}</div><div class="ranking-info"><div class="ranking-name">${r[0]}</div><div class="ranking-days">${r[1]} d√≠a${r[1]==1?'':'s'} trabajados esta semana</div></div><div class="ranking-priority">${prioText}</div></div>`;
      });
      document.getElementById('rankingContainer').innerHTML = html;
    }
    getCSV("https://docs.google.com/spreadsheets/d/e/2PACX-1vS5vmKQNZSM06OL_-rrNCq9mqx-z1cAL7fjlCsYw-iOtgmEMNGevSI6bwpy1Q0NH47dj5LNnRsqQ6QE/pub?gid=143658271&single=true&output=csv")
      .then(data => showRanking(data));
  </script>
</body>
</html>
